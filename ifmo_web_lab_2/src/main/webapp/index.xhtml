<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html
        PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:ui="http://java.sun.com/jsf/facelets"
      xmlns:f="http://java.sun.com/jsf/core">

<h:head>
    <title>Dmitri project</title>
    <link rel="stylesheet" href="css/header.css"/>
    <link rel="stylesheet" href="css/index.css"/>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <script type="text/javascript" charset="UTF-8"
            src="https://cdn.jsdelivr.net/npm/jsxgraph/distrib/jsxgraphcore.js"></script>
    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/jsxgraph/distrib/jsxgraph.css"/>
    <script src="js/submit.js"></script>
    <script src="js/tableWorker.js"></script>
    <script src="js/validator.js"></script>
    <script src="js/graph.js"></script>
</h:head>

<h:body onload="setTimezone()">
    <header class="header">
        <a href="https://github.com/DmitriBazilov">Базилов Дмитрий P32141 / 142605</a>
        <h:link outcome="jumpToMain">
            Стартовая страница
        </h:link>
    </header>
    

    <div class="menu">
        <div class="graph">
            <div id="jxgbox" class="jxgbox" style="width:300px; height:300px; margin-left:30px;"></div>
        </div>
        
        <h:form id="formSend" styleClass="data_input">

            <div class="x_input">
                <span>Выберите X: </span>
               <!--  <h:inputText styleClass="text_input" id="x_value" value="#{hitCheck.x}" required="true" requiredMessage="Incorrect X"/> -->

                 <input type="range" min="-5" max="5" value="0" class="slider" id="x_slider"/>
                 <span id="slider_value">0</span>
                 <h:inputHidden value="#{hitCheck.x}" id="x_value">
                 </h:inputHidden>
                 <h:message styleClass="error" for="x_value" id="x_error" class="error"/>
            </div>

            <div class="y_input">
                <span>Введите Y: </span>
                <h:inputText styleClass="text_input" style="margin-left: 25px"
                id="y_value" value="#{hitCheck.y}" required="true" requiredMessage="Введите Y" maxlength="15">
                </h:inputText>
                <h:message styleClass="error" for="y_value" id="y_error"></h:message>
            </div>

            <div class="r_input">
                <span>Выберите R: </span>
                <h:selectOneRadio styleClass="r_input_table" id="r_value" 
                value="#{hitCheck.r}"
                required="true" requiredMessage="Выберите R">
                    <f:selectItem itemValue="1" itemLabel="1"/>
                    <f:selectItem itemValue="2" itemLabel="2"/>
                    <f:selectItem itemValue="3" itemLabel="3"/>
                    <f:selectItem itemValue="4" itemLabel="4"/>
                    <f:selectItem itemValue="5" itemLabel="5"/>
                </h:selectOneRadio>
                <h:message styleClass="error" for="r_value" id="r_error" class="error"/>
            </div>

            <h:inputHidden value="#{hitCheck.timezone}" id="timezone"/>

            <h:commandButton onclick="setTimezone();checkY()" styleClass="button" value="Submit" action="#{hitCheck.save()}">
                <f:ajax execute="@form" render="result_table y_error r_error script"></f:ajax>
            </h:commandButton>
        </h:form>
    </div>
    <h:panelGroup id="script">
        <h:outputScript>
            function updatePoints() {
            clearPoints();
            serverPoints = [
            <ui:repeat value="#{table.getHitsBySessionId(sessionGetter.getSessionId())}" var="hit">
                {x: #{hit.x}, y: #{hit.y}, r: #{hit.r}, hit: #{hit.result}},
            </ui:repeat>
            ];
            console.log(serverPoints);
            drawPointsByR($('[name="formSend:r_value"]:checked').val());
            }
            updatePoints();
        </h:outputScript>
    </h:panelGroup>

    <h:commandButton styleClass="button" value="Clean" 
    action="#{hitCheck.removeSessionDots(sessionGetter.getSessionId())}">
        <f:ajax render="result_table script"/>
    </h:commandButton>

    <div class="table">
        <h:dataTable id="result_table" 
        value="#{table.getHitsBySessionId(sessionGetter.getSessionId())}" var="hit">

            <h:column>
                <f:facet name="header">X</f:facet>
                #{hit.x}
            </h:column>

            <h:column>
                <f:facet name="header">Y</f:facet>
                #{hit.y}
            </h:column>

            <h:column>
                <f:facet name="header">R</f:facet>
                #{hit.r}
            </h:column>

            <h:column>
                <f:facet name="header">Дата проверки</f:facet>
                #{hit.getCurrentTimeAsString()}
            </h:column>
            
            <h:column>
                <f:facet name="header">Время исполнения</f:facet>
                #{hit.executeTime} мс
            </h:column>

            <h:column>
                <f:facet name="header">Результат</f:facet>
                #{hit.getFancyResult()}
            </h:column>

        </h:dataTable>
    </div>
</h:body>

</html>
